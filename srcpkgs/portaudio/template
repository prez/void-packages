# Template file for 'portaudio'
pkgname=portaudio
reverts="190600.20161030_1 190600.20161030_2 190600.20161030_3 190600.20161030_4 190600.20161030_5 190600.20161030_6"
version=19.7.0
revision=1
build_style=gnu-configure
configure_args="--enable-cxx --with-jack $(vopt_enable sndio)"
hostmakedepends="automake libtool pkg-config"
makedepends="alsa-lib-devel jack-devel $(vopt_if sndio sndio-devel)"
short_desc="Portable cross-platform audio I/O library"
maintainer="Ã‰rico Nogueira <ericonr@disroot.org>"
license="MIT"
homepage="http://www.portaudio.com"
distfiles="https://github.com/PortAudio/portaudio/archive/v${version}.tar.gz"
checksum=5af29ba58bbdbb7bbcefaaecc77ec8fc413f0db6f4c4e286c40c3e1b83174fa0
disable_parallel_build=yes

# sndio disabled by default: non-upstream patch
build_options="sndio"
build_options_default=""

pre_configure() {
	# depcomp is required when building the bindings/cpp extension
	# but will be removed by autoreconf + libtool >= 2.4.6
	# Protect it from removal
	mv depcomp{,~}

	autoreconf -fi

	# Restore depcomp
	mv depcomp{~,}
}

post_install() {
	vlicense LICENSE.txt
}

portaudio-devel_package() {
	depends="${makedepends} portaudio>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove "usr/include/*.h"
		vmove usr/lib/libportaudio.a
		vmove usr/lib/libportaudio.so
		vmove usr/lib/pkgconfig/portaudio-2.0.pc
	}
}

portaudio-cpp_package() {
	short_desc+=" - C++ Bindings"
	pkg_install() {
		vmove "usr/lib/libportaudiocpp.so.*"
	}
}

portaudio-cpp-devel_package() {
	depends="portaudio-cpp>=${version}_${revision} portaudio-devel>=${version}_${revision}"
	short_desc+=" - C++ bindings development files"
	pkg_install() {
		vmove usr/include/portaudiocpp
		vmove usr/lib/pkgconfig/portaudiocpp.pc
		vmove usr/lib/libportaudiocpp.a
		vmove usr/lib/libportaudiocpp.so
	}
}
